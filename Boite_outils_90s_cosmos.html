<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Boîte à outils — 90 secondes (Voie lactée + Phénix & constellations)</title>
<style>
  :root{
    --space1:#080c1a; --space2:#0f1630; --space3:#1a2250;
    --gold:#ffd36a; --gold2:#fbbf24;
    --panelBorder: rgba(255,255,255,.28);
    --text:#eaeef8; --textDim: rgba(234,238,248,.9);
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--space1),var(--space2) 50%,var(--space3));color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Arial,"Helvetica Neue"}
  .container{position:relative;min-height:100%;overflow:hidden}
  .content{position:relative;z-index:10;max-width:1100px;margin:0 auto;padding:24px 16px 64px}
  h1{font-size:clamp(28px,4vw,44px);margin:.2rem 0;color:#fff; text-shadow:0 2px 12px rgba(0,0,0,.45)}
  .subtitle{color:rgba(255,255,255,.92);font-size:14px}
  .badges{display:flex;gap:8px;justify-content:center;margin-top:8px;flex-wrap:wrap}
  .badge{display:inline-block;padding:6px 10px;border-radius:999px;font-size:12px;margin:4px;color:#0b1220;background:var(--gold);font-weight:800}
  .badge.dim{background:rgba(255,255,255,.18);color:#fff}
  .grid{display:grid;gap:20px;margin-top:20px}
  @media (min-width:992px){ .grid{grid-template-columns: 1fr 2fr} }
  .panel{background:rgba(15,20,40,.35);border:1px solid var(--panelBorder);border-radius:16px;padding:20px;backdrop-filter:blur(8px);box-shadow:0 8px 30px rgba(0,0,0,.35)}
  .btn{border:0;border-radius:999px;padding:10px 16px;font-weight:800;cursor:pointer;letter-spacing:.2px}
  .btn.primary{background:var(--gold);color:#0b1220}
  .btn.ghost{background:transparent;border:1px solid var(--panelBorder);color:#fff}
  .btn.toggle{background:rgba(255,255,255,.10);border:1px solid var(--panelBorder);color:#fff}
  .controls{display:flex;flex-wrap:wrap;gap:8px;justify-content:center}
  .ring{height:176px;width:176px;margin:0 auto;position:relative}
  .ring svg{height:176px;width:176px;display:block}
  .ring .center{position:absolute;inset:0;display:grid;place-items:center;text-align:center}
  .ring .sec{font-size:36px;font-weight:800;color:var(--gold);font-variant-numeric:tabular-nums;text-shadow:0 2px 10px rgba(0,0,0,.35)}
  .ring .sub{font-size:12px;color:#fff}
  .progressBar{height:12px;border-radius:999px;background:rgba(255,255,255,.18);overflow:hidden}
  .progressBar > div{height:100%;background:var(--gold)}
  .phasePanel{border:1px solid var(--panelBorder);border-radius:16px;padding:16px;background:rgba(15,20,40,.35)}
  .phasePanel.active{border-color:rgba(255,211,106,.6);background:rgba(255,211,106,.12)}
  .phaseTitle{color:var(--gold);font-weight:900;margin-bottom:8px;letter-spacing:.3px}
  .bullet{display:flex;gap:8px;margin:8px 0;color:var(--textDim);font-size:14px}
  .dot{width:6px;height:6px;border-radius:50%;background:var(--gold);margin-top:6px;flex:0 0 auto}
  .field{width:100%;border-radius:12px;border:1px solid var(--panelBorder);background:rgba(255,255,255,.10);color:#fff;padding:10px 12px}
  .chip{padding:6px 10px;border-radius:999px;border:1px solid var(--panelBorder);background:rgba(255,255,255,.08);color:#fff;font-size:12px;cursor:pointer}
  .footerTag{display:inline-block;border:1px solid var(--panelBorder);border-radius:999px;padding:8px 14px;color:#0b1220;background:var(--gold);font-weight:900}
  .tips{font-size:12px;color:#fff;text-align:center;margin-top:8px;text-shadow:0 1px 4px rgba(0,0,0,.4)}
  /* Cosmic background layers */
  .sky{position:absolute;inset:0;z-index:0;overflow:visible}
  .twinkle{animation: twinkle 2.4s infinite ease-in-out}
  @keyframes twinkle { 0%,100%{opacity:.5} 50%{opacity:1} }
  .parallax-slow{animation: pan 160s linear infinite}
  .parallax-med{animation: pan 120s linear infinite reverse}
  .parallax-fast{animation: pan 90s linear infinite}
  @keyframes pan { from{ transform: translateX(-5%) } to{ transform: translateX(5%) } }
  .shooting{position:absolute;width:2px;height:2px;background:#fff;box-shadow:0 0 6px #fff;border-radius:50%;animation: shoot 6s linear infinite;opacity:.85}
  @keyframes shoot { from{ transform:translateX(-10vw) translateY(-10vh); opacity:.0 } 20%{opacity:.95} to{ transform:translateX(110vw) translateY(60vh); opacity:0 } }
  .planet{filter: drop-shadow(0 0 18px rgba(255,255,255,.25));}
  .ringGlow{filter: drop-shadow(0 0 8px rgba(255,255,255,.35));opacity:.7}
  .instrBox .instr{font-size:13px; color:#e9eefc; opacity:.96; line-height:1.5}
  /* Constellations & phoenix */
  .constel, .phoenixAstral{opacity:.18; transition: opacity .7s ease, filter .7s ease}
  .constel.active, .phoenixAstral.active{opacity:.95; filter: drop-shadow(0 0 10px rgba(255,211,106,.65))}
  .constel line{stroke:#ffd36a; stroke-width:1.6; stroke-linecap:round; opacity:.7}
  .constel circle{fill:#fff}
  .phoenixAstral path, .phoenixAstral circle, .phoenixAstral line{stroke:#ffd36a; stroke-width:1.8; fill:none; stroke-linecap:round}
  .phoenixAstral .glow{stroke-width:3; opacity:.45}
</style>
</head>
<body>
<div class="container">
  <!-- Cosmic SVG with Milky Way band + Astral Phoenix + Constellations -->
  <svg class="sky" viewBox="0 0 1200 800" preserveAspectRatio="xMidYMid slice" aria-hidden>
    <defs>
      <radialGradient id="nebulaA" cx="20%" cy="20%" r="35%">
        <stop offset="0%" stop-color="#5b21b6" stop-opacity=".55"/>
        <stop offset="60%" stop-color="#5b21b6" stop-opacity=".15"/>
        <stop offset="100%" stop-color="#5b21b6" stop-opacity="0"/>
      </radialGradient>
      <radialGradient id="nebulaB" cx="75%" cy="25%" r="40%">
        <stop offset="0%" stop-color="#0ea5e9" stop-opacity=".45"/>
        <stop offset="60%" stop-color="#0ea5e9" stop-opacity=".12"/>
        <stop offset="100%" stop-color="#0ea5e9" stop-opacity="0"/>
      </radialGradient>
      <radialGradient id="nebulaC" cx="55%" cy="55%" r="30%">
        <stop offset="0%" stop-color="#f472b6" stop-opacity=".30"/>
        <stop offset="70%" stop-color="#f472b6" stop-opacity=".08"/>
        <stop offset="100%" stop-color="#f472b6" stop-opacity="0"/>
      </radialGradient>
      <radialGradient id="planet1" cx="35%" cy="35%" r="70%">
        <stop offset="0%" stop-color="#cbd5ff"/>
        <stop offset="50%" stop-color="#7c9cff"/>
        <stop offset="100%" stop-color="#2a3a8f"/>
      </radialGradient>
      <radialGradient id="planet2" cx="65%" cy="60%" r="70%">
        <stop offset="0%" stop-color="#ffe7c2"/>
        <stop offset="60%" stop-color="#e5b06a"/>
        <stop offset="100%" stop-color="#9a6a2a"/>
      </radialGradient>
      <linearGradient id="mwGlow" x1="0" y1="0" x2="1" y2="1">
        <stop offset="0%" stop-color="#ffffff" stop-opacity="0.1"/>
        <stop offset="50%" stop-color="#ffffff" stop-opacity="0.25"/>
        <stop offset="100%" stop-color="#ffffff" stop-opacity="0.1"/>
      </linearGradient>
    </defs>
    <!-- nebulas -->
    <circle cx="200" cy="160" r="360" fill="url(#nebulaA)" class="parallax-slow"/>
    <circle cx="900" cy="180" r="420" fill="url(#nebulaB)" class="parallax-med"/>
    <circle cx="700" cy="520" r="320" fill="url(#nebulaC)" class="parallax-fast"/>
    <!-- planets -->
    <g class="planet parallax-slow">
      <circle cx="210" cy="520" r="90" fill="url(#planet2)"/>
      <g class="ringGlow">
        <ellipse cx="210" cy="520" rx="130" ry="24" fill="none" stroke="rgba(255,255,255,.65)" stroke-width="2"/>
      </g>
    </g>
    <g class="planet parallax-med">
      <circle cx="980" cy="120" r="70" fill="url(#planet1)"/>
    </g>
    <!-- Milky Way band (diagonal soft glow) -->
    <g transform="rotate(-24 600 400) translate(-60,0)">
      <rect x="0" y="330" width="1300" height="140" fill="url(#mwGlow)" />
    </g>

    <!-- Orion constellation -->
    <g id="constelOrion" class="constel">
      <!-- star points (approx positions) -->
      <circle cx="820" cy="360" r="2"/><!-- Betelgeuse -->
      <circle cx="900" cy="410" r="2"/><!-- Bellatrix -->
      <circle cx="860" cy="470" r="2"/><!-- Alnilam (belt middle) -->
      <circle cx="830" cy="470" r="2"/><!-- Alnitak -->
      <circle cx="890" cy="470" r="2"/><!-- Mintaka -->
      <circle cx="820" cy="540" r="2"/><!-- Saiph -->
      <circle cx="930" cy="520" r="2"/><!-- Rigel -->
      <!-- lines -->
      <line x1="820" y1="360" x2="900" y2="410"/>
      <line x1="820" y1="360" x2="830" y2="470"/>
      <line x1="900" y1="410" x2="890" y2="470"/>
      <line x1="830" y1="470" x2="860" y2="470"/>
      <line x1="860" y1="470" x2="890" y2="470"/>
      <line x1="830" y1="470" x2="820" y2="540"/>
      <line x1="890" y1="470" x2="930" y2="520"/>
      <line x1="820" y1="540" x2="930" y2="520"/>
    </g>

    <!-- Cassiopeia constellation -->
    <g id="constelCassiopeia" class="constel">
      <!-- W shape near top-left -->
      <circle cx="280" cy="160" r="2"/>
      <circle cx="320" cy="190" r="2"/>
      <circle cx="360" cy="150" r="2"/>
      <circle cx="400" cy="190" r="2"/>
      <circle cx="440" cy="160" r="2"/>
      <line x1="280" y1="160" x2="320" y2="190"/>
      <line x1="320" y1="190" x2="360" y2="150"/>
      <line x1="360" y1="150" x2="400" y2="190"/>
      <line x1="400" y1="190" x2="440" y2="160"/>
    </g>

    <!-- Astral Phoenix (discreet, lower-right quadrant) -->
    <g id="phoenixAstral" class="phoenixAstral" transform="translate(880,520) scale(0.8)">
      <!-- body arc -->
      <path d="M -40 20 C -30 -20, 10 -40, 40 -10" class="glow"/>
      <path d="M -40 20 C -30 -20, 10 -40, 40 -10"/>
      <!-- head + beak -->
      <circle cx="52" cy="-12" r="6"/>
      <line x1="58" y1="-12" x2="68" y2="-15"/>
      <!-- eye -->
      <circle cx="54" cy="-12" r="1.2" />
      <!-- wings -->
      <path d="M 10 -8 C -20 -40, -80 -20, -120 -10" />
      <path d="M 12 -6 C -10 -26, -60 -8, -96 0" />
      <path d="M 8 -10 C 40 -50, 100 -30, 140 -10" />
      <path d="M 10 -7 C 30 -27, 80 -20, 120 -8" />
      <!-- tail plumes -->
      <path d="M -20 18 C -40 40, -60 70, -72 96" />
      <path d="M -10 20 C -20 44, -36 74, -44 102" />
      <path d="M 0 22 C -6 50, -10 80, -12 104" />
      <!-- sparkles -->
      <circle cx="-30" cy="-6" r="1.4"/><circle cx="-18" cy="4" r="1.2"/><circle cx="26" cy="-22" r="1.2"/>
    </g>

    <!-- a base layer of static twinkles -->
    <g id="starsBase" fill="#fff" opacity=".9">
      <circle class="twinkle" cx="180" cy="100" r="1.2"/>
      <circle class="twinkle" cx="360" cy="180" r="1.1"/>
      <circle class="twinkle" cx="540" cy="80"  r="1.2"/>
      <circle class="twinkle" cx="720" cy="160" r="1.0"/>
      <circle class="twinkle" cx="960" cy="220" r="1.3"/>
      <circle class="twinkle" cx="1080" cy="60" r="1.1"/>
      <circle class="twinkle" cx="260" cy="300" r="1.0"/>
      <circle class="twinkle" cx="640" cy="280" r="1.2"/>
    </g>
    <!-- dynamic star groups for motion -->
    <g id="starsSlow" class="parallax-slow"></g>
    <g id="starsMed"  class="parallax-med"></g>
    <g id="starsFast" class="parallax-fast"></g>
    <!-- script to populate Milky Way and moving stars -->
    <script type="application/ecmascript"><![CDATA[
      const svg = document.currentScript.ownerSVGElement;
      function rand(min,max){ return Math.random()*(max-min)+min; }
      // Populate parallax groups with random stars
      function addStars(gId, count, opacityRange){
        const g = svg.getElementById? svg.getElementById(gId) : document.getElementById(gId);
        for(let i=0;i<count;i++){
          const c = document.createElementNS('http://www.w3.org/2000/svg','circle');
          c.setAttribute('cx', (Math.random()*1200).toFixed(2));
          c.setAttribute('cy', (Math.random()*800).toFixed(2));
          c.setAttribute('r', (Math.random()*1.2+0.2).toFixed(2));
          c.setAttribute('fill', '#fff');
          c.setAttribute('opacity', (rand(opacityRange[0], opacityRange[1])).toFixed(2));
          c.setAttribute('class','twinkle');
          g.appendChild(c);
        }
      }
      addStars('starsSlow', 120, [0.2,0.6]);
      addStars('starsMed',  140, [0.3,0.8]);
      addStars('starsFast', 100, [0.4,0.9]);
      // Milky Way dense star band
      const band = document.createElementNS('http://www.w3.org/2000/svg','g');
      const transform = 'rotate(-24 600 400) translate(-60,0)';
      band.setAttribute('transform', transform);
      for(let i=0;i<700;i++){
        const x = Math.random()*1300;
        const y = 330 + 140*Math.random();
        const r = Math.random()*1.4 + 0.2;
        const alpha = 0.35 + 0.65*Math.random();
        const c = document.createElementNS('http://www.w3.org/2000/svg','circle');
        c.setAttribute('cx', x.toFixed(1));
        c.setAttribute('cy', y.toFixed(1));
        c.setAttribute('r', r.toFixed(2));
        c.setAttribute('fill', '#fff');
        c.setAttribute('opacity', alpha.toFixed(2));
        c.setAttribute('class','twinkle');
        band.appendChild(c);
      }
      svg.appendChild(band);
    ]]></script>
  </svg>
  <!-- shooting stars (HTML elements animated) -->
  <div id="shootingContainer"></div>

  <div class="content">
    <div style="text-align:center">
      <h1>Boîte à outils — 90 secondes</h1>
      <div class="subtitle">Voie lactée • Étoiles en mouvement • Planètes</div>
      <div class="badges">
        <span id="bResp" class="badge">Respiration</span>
        <span id="bAncr" class="badge dim">Ancrage</span>
        <span id="bInt"  class="badge dim">Intention</span>
      </div>
    </div>

    <div class="grid">
      <!-- Timer & controls -->
      <div class="panel" style="text-align:center">
        <div class="ring">
          <svg viewBox="0 0 100 100">
            <circle cx="50" cy="50" r="44" fill="none" stroke="rgba(255,255,255,.22)" stroke-width="8"/>
            <circle id="ring" cx="50" cy="50" r="44" fill="none" stroke="var(--gold)" stroke-width="8"
              stroke-dasharray="0 100" stroke-dashoffset="0" pathLength="100" stroke-linecap="round"/>
          </svg>
          <div class="center">
            <div class="sec" id="sec">0s</div>
            <div class="sub">sur 90</div>
          </div>
        </div>

        <div id="breathBox" style="margin-top:12px;display:none">
          <div style="font-size:12px;color:var(--gold)" id="breathLabel">Inspire… 4</div>
          <div class="progressBar" style="width:260px;margin:6px auto 0">
            <div id="breathProg" style="width:8%"></div>
          </div>
          <div class="tips">Cycle 4–2–6 • Nez → Pause → Bouche</div>
        </div>

        <div class="controls" style="margin-top:12px">
          <button id="btnStart" class="btn primary">Démarrer</button>
          <button id="btnPause" class="btn primary" style="display:none">Pause</button>
          <button id="btnResume" class="btn primary" style="display:none">Reprendre</button>
          <button id="btnReset" class="btn ghost">Réinitialiser</button>
          <button id="btnSound" class="btn toggle">Son : ON</button>
        </div>

        <div class="panel instrBox" style="margin-top:14px">
          <div style="text-align:left">
            <div class="phaseTitle" style="margin-bottom:6px">Consignes</div>
            <ol class="instr">
              <li><b>Respiration (0–30 s)</b> — Inspire 4 (nez), garde 2, expire 6 (bouche). Épaules et mâchoire détendues.</li>
              <li><b>Ancrage (30–60 s)</b> — Sens les pieds / le siège. Redresse-toi d’1 cm. Poids stable, souffle bas.</li>
              <li><b>Intention (60–90 s)</b> — Choisis un mot utile à ton sevrage. Fais un micro-geste concret maintenant.</li>
            </ol>
          </div>
        </div>
      </div>

      <!-- Phases -->
      <div class="grid" style="grid-template-columns: repeat(3, 1fr)">
        <div id="p0" class="phasePanel active">
          <div class="phaseTitle">Respiration 4–2–6</div>
          <div class="bullet"><span class="dot"></span><span>Inspire 4 s (nez)</span></div>
          <div class="bullet"><span class="dot"></span><span>Garde 2 s (douceur)</span></div>
          <div class="bullet"><span class="dot"></span><span>Expire 6 s (bouche)</span></div>
          <div class="bullet"><span class="dot"></span><span>Épaules et mâchoire détendues</span></div>
        </div>
        <div id="p1" class="phasePanel">
          <div class="phaseTitle">Ancrage</div>
          <div class="bullet"><span class="dot"></span><span>Sensation des pieds / du siège</span></div>
          <div class="bullet"><span class="dot"></span><span>Redresse-toi d’1 cm, nuque longue</span></div>
          <div class="bullet"><span class="dot"></span><span>Poids stable, souffle bas</span></div>
        </div>
        <div id="p2" class="phasePanel">
          <div class="phaseTitle">Intention (sevrage gagnant)</div>
          <div class="bullet"><span class="dot"></span><span>Choisis 1 mot qui te sert <i>aujourd’hui</i></span></div>
          <div class="bullet"><span class="dot"></span><span>Fais un micro-geste tout de suite</span></div>
          <label style="font-size:12px;color:var(--gold);display:block;margin-top:8px">Ton mot / phrase</label>
          <input id="intent" class="field" placeholder="ex. Je suis libre. Je développe ma confiance.">
          <div class="controls" style="justify-content:flex-start;margin-top:8px;gap:6px">
            <span class="chip" onclick="addIntent('Je suis libre')">Je suis libre</span>
            <span class="chip" onclick="addIntent('Je développe ma confiance')">Je développe ma confiance</span>
            <span class="chip" onclick="addIntent('Je brise toutes les chaînes')">Je brise toutes les chaînes</span>
            <span class="chip" onclick="addIntent('Mon souffle est mon allié')">Mon souffle est mon allié</span>
            <span class="chip" onclick="addIntent('Je choisis la vie')">Je choisis la vie</span>
            <span class="chip" onclick="addIntent('Je me respecte')">Je me respecte</span>
            <span class="chip" onclick="addIntent('Chaque jour je deviens plus fort·e')">Chaque jour je deviens plus fort·e</span>
            <span class="chip" onclick="addIntent('Mon corps se répare')">Mon corps se répare</span>
            <span class="chip" onclick="addIntent('Je tiens bon')">Je tiens bon</span>
            <span class="chip" onclick="addIntent('Je protège mes poumons')">Je protège mes poumons</span>
          </div>
        </div>
      </div>

      <div style="text-align:center;margin-top:10px">
        <span class="footerTag">Je reviens à moi — maintenant.</span>
      </div>
    </div>
  </div>
</div>

<script>
(function(){
  let running = false, sec = 0, phase = 0;
  let soundOn = true;
  let breathIdx = 0, breathT = 0;
  const breathSteps = [
    {label:'Inspire', dur:4},
    {label:'Pause', dur:2},
    {label:'Expire', dur:6},
  ];
  let timerId = null, breathId = null;

  const $ = id => document.getElementById(id);
  const ring = $('ring'), secEl = $('sec'), breathBox = $('breathBox'),
        breathLabel=$('breathLabel'), breathProg=$('breathProg');
  const bResp=$('bResp'), bAncr=$('bAncr'), bInt=$('bInt');
  const p0=$('p0'), p1=$('p1'), p2=$('p2');
  const btnStart=$('btnStart'), btnPause=$('btnPause'), btnResume=$('btnResume'),
        btnReset=$('btnReset'), btnSound=$('btnSound');
  const intent=$('intent');
  const orion = document.getElementById('constelOrion');
  const cass  = document.getElementById('constelCassiopeia');
  const phoenix = document.getElementById('phoenixAstral');

  // shooting stars
  (function shooting(){
    const container = document.getElementById('shootingContainer');
    for(let i=0;i<4;i++){
      const s = document.createElement('div');
      s.className = 'shooting';
      s.style.top = (10 + Math.random()*50) + 'vh';
      s.style.left = (Math.random()*30) + 'vw';
      s.style.animationDelay = (i*2+Math.random()*3)+'s';
      container.appendChild(s);
    }
  })();

  window.addIntent = (txt)=>{
    if(!intent.value) intent.value = txt;
    else intent.value = intent.value + (intent.value.endsWith('.')?'':'. ') + txt;
    localStorage.setItem('intention90s', intent.value);
  };

  // restore intention
  const saved = localStorage.getItem('intention90s');
  if(saved) intent.value = saved;
  intent.addEventListener('input', ()=> localStorage.setItem('intention90s', intent.value));

  function ensureAudio(){
    const Ctx = window.AudioContext || window.webkitAudioContext;
    if(!Ctx) return null;
    if(!ensureAudio.ctx) ensureAudio.ctx = new Ctx();
    return ensureAudio.ctx;
  }
  function beep(freq=660, dur=0.12, volume=0.07){
    if(!soundOn) return;
    const ctx = ensureAudio(); if(!ctx) return;
    const osc = ctx.createOscillator(), gain = ctx.createGain();
    osc.type = 'sine'; osc.frequency.value = freq; gain.gain.value = volume;
    osc.connect(gain); gain.connect(ctx.destination);
    const now = ctx.currentTime; osc.start(now); osc.stop(now+dur);
  }

  function setPhaseFromSec(s){
    const old = phase;
    phase = s < 30 ? 0 : (s < 60 ? 1 : 2);
    if(phase !== old){ updatePhaseUI(); }
  }
  function updatePhaseUI(){
    [p0,p1,p2].forEach((el,i)=>{ el.classList.toggle('active', i===phase); });
    [bResp,bAncr,bInt].forEach((el,i)=>{ el.classList.toggle('dim', i!==phase); });
    breathBox.style.display = phase===0 ? 'block' : 'none';
    // Toggle constellations & phoenix glow only in Intention phase
    const on = phase===2;
    [orion, cass, phoenix].forEach(el => el && el.classList.toggle('active', on));
  }

  function updateRing(){
    const pct = (sec/90)*100;
    ring.setAttribute('stroke-dasharray', Math.max(0.01, pct)+' 100');
    secEl.textContent = sec+'s';
  }

  function tick(){
    sec++;
    if(sec===30||sec===60||sec===90) beep(440 + sec/2, .12, .08);
    if(sec>=90){ stop(); sec=90; updateRing(); return; }
    setPhaseFromSec(sec); updateRing();
  }

  function start(){
    stop(); // reset intervals
    running = true; sec = 0; setPhaseFromSec(0); updateRing();
    btnStart.style.display='none'; btnPause.style.display='inline-block'; btnResume.style.display='none';
    timerId = setInterval(tick, 1000);
    // breath cycle with countdown label
    breathIdx=0; breathT=0; breathBox.style.display='block';
    breathLabel.textContent = breathSteps[breathIdx].label + '… ' + (breathSteps[breathIdx].dur - breathT);
    breathProg.style.width = '8%';
    breathId = setInterval(()=>{
      breathT++;
      const step = breathSteps[breathIdx];
      const remaining = Math.max(0, step.dur - breathT);
      const prog = Math.max(6, (breathT/step.dur)*100);
      breathProg.style.width = prog+'%';
      breathLabel.textContent = step.label + '… ' + remaining;
      if(breathT >= step.dur){
        breathT=0; breathIdx=(breathIdx+1)%breathSteps.length;
        breathLabel.textContent = breathSteps[breathIdx].label + '… ' + breathSteps[breathIdx].dur;
        beep(phase===0?780:600, .07, .06);
      }
    }, 1000);
  }
  function pause(){
    if(!running) return;
    running=false;
    clearInterval(timerId); clearInterval(breathId);
    btnPause.style.display='none'; btnResume.style.display='inline-block'; btnStart.style.display='none';
  }
  function resume(){
    if(running) return;
    running=true;
    btnPause.style.display='inline-block'; btnResume.style.display='none';
    timerId = setInterval(tick, 1000);
    if(phase===0){
      breathId = setInterval(()=>{
        breathT++;
        const step = breathSteps[breathIdx];
        const remaining = Math.max(0, step.dur - breathT);
        const prog = Math.max(6, (breathT/step.dur)*100);
        breathProg.style.width = prog+'%';
        breathLabel.textContent = step.label + '… ' + remaining;
        if(breathT >= step.dur){
          breathT=0; breathIdx=(breathIdx+1)%breathSteps.length;
          breathLabel.textContent = breathSteps[breathIdx].label + '… ' + breathSteps[breathIdx].dur;
          beep(780, .07, .06);
        }
      }, 1000);
    }
  }
  function reset(){
    stop(); sec=0; phase=0; updatePhaseUI(); updateRing();
    btnStart.style.display='inline-block'; btnPause.style.display='none'; btnResume.style.display='none';
  }
  function stop(){
    running=false;
    clearInterval(timerId); clearInterval(breathId);
    timerId=null; breathId=null;
  }

  document.getElementById('btnStart').addEventListener('click', start);
  document.getElementById('btnPause').addEventListener('click', pause);
  document.getElementById('btnResume').addEventListener('click', resume);
  document.getElementById('btnReset').addEventListener('click', reset);
  document.getElementById('btnSound').addEventListener('click', ()=>{
    soundOn = !soundOn; document.getElementById('btnSound').textContent = 'Son : ' + (soundOn?'ON':'OFF');
    if(soundOn) beep(880, .08, .06);
  });

  updatePhaseUI(); updateRing();
})();</script>
</body>
</html>
